<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>üöÄ Productivity Boost Hub</title>
  <link rel="icon" href="https://cdn-icons-png.flaticon.com/512/3135/3135715.png" type="image/png" />
  <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@600&display=swap" rel="stylesheet">
  <style>
    :root {
      --bg: linear-gradient(135deg, #0f2027, #203a43, #2c5364);
      --card-bg: rgba(255, 255, 255, 0.05);
      --border: rgba(255, 255, 255, 0.1);
      --accent: #00fff7;
      --accent-2: #9ef5ff;
      --text: #e0f7fa;
      --muted: #b7dfe6;
      --text-glow: 0 0 5px #00fff7;
      --button-bg: #00fff7;
      --button-text: #000;
      --button-glow: 0 0 10px #00fff7;
      --focus: 0 0 0 3px rgba(0, 255, 247, 0.35);
      --radius: 14px;
    }

    * { box-sizing: border-box; }

    body {
      margin: 0;
      padding: 2rem clamp(1rem, 3vw, 2rem);
      font-family: 'Orbitron', system-ui, -apple-system, Segoe UI, Roboto, sans-serif;
      background: var(--bg);
      color: var(--text);
      min-height: 100vh;
      display: flex;
      flex-direction: column;
    }

    h1 {
      font-size: clamp(1.6rem, 2.2rem + 0.5vw, 2.4rem);
      margin: 0 0 1.25rem 0;
      color: var(--accent);
      text-shadow: var(--text-glow);
      letter-spacing: .5px;
      display: flex; align-items: center; gap:.6rem;
      animation: fadeInUp .9s ease-out;
    }

    @keyframes fadeInUp {
      from { opacity: 0; transform: translateY(16px); }
      to { opacity: 1; transform: translateY(0); }
    }

    .topbar {
      display: grid;
      grid-template-columns: 1fr;
      gap: .75rem;
      margin-bottom: 1rem;
    }

    /* Tabs */
    .tabs {
      display: flex;
      gap: .6rem;
      flex-wrap: wrap;
    }

    .tab {
      -webkit-tap-highlight-color: transparent;
      padding: .55rem 0.9rem;
      border-radius: var(--radius);
      background: var(--card-bg);
      border: 1px solid var(--border);
      cursor: pointer;
      transition: transform .15s ease, box-shadow .2s ease, background .2s ease, border-color .2s ease;
      user-select: none;
      font-weight: 700;
    }
    .tab[aria-selected="true"], .tab.active { background: var(--accent); color: #111; box-shadow: var(--button-glow); border-color: transparent; }
    .tab:focus-visible { outline: none; box-shadow: var(--focus); }

    /* Controls */
    .controls {
      display: flex; align-items: center; gap: .6rem; flex-wrap: wrap;
    }
    .btn {
      background: var(--button-bg);
      color: var(--button-text);
      padding: .55rem .9rem;
      border: none;
      border-radius: 10px;
      cursor: pointer;
      font-weight: 800;
      box-shadow: var(--button-glow);
      transition: transform .12s ease, filter .2s ease;
    }
    .btn:hover { transform: translateY(-1px); }
    .btn.secondary { background: transparent; color: var(--accent-2); border: 1px solid var(--border); box-shadow: none; }

    .pill { font-size: .95rem; padding:.45rem .7rem; background: var(--card-bg); border:1px solid var(--border); border-radius: 999px; }

    /* Sections */
    .section { display: none; }
    .section.active { display: block; }

    /* Category accordion */
    .category {
      background: var(--card-bg);
      margin-bottom: .8rem;
      border-radius: var(--radius);
      overflow: hidden;
      border: 1px solid var(--border);
    }
    .category-header {
      padding: .9rem 1rem;
      font-size: 1.05rem;
      cursor: pointer;
      display: flex; justify-content: space-between; align-items: center;
      background-color: rgba(255,255,255,.07);
      gap: .8rem;
    }
    .category-content { display: none; padding: .9rem 1rem; border-top: 1px solid var(--border); }
    .category.open .category-content { display: block; }

    /* Inputs */
    .search {
      width: 100%;
      border-radius: 12px;
      border: 1px solid var(--border);
      background: var(--card-bg);
      padding: .7rem .9rem;
      color: var(--text);
      outline: none;
    }
    .search:focus { box-shadow: var(--focus); }

    /* Simple tool list (legacy) */
    .tool-list { list-style:none; padding-left:0; margin: .6rem 0 0 0; display:grid; gap:.6rem; }
    .tool-link {
      display:inline-flex; align-items:center; gap:.5rem;
      color: var(--accent);
      text-decoration: none;
      font-weight: 800;
      padding: .6rem .8rem;
      border-radius: 10px;
      border: 1px solid var(--border);
      background: var(--card-bg);
      transition: box-shadow .2s ease, transform .1s ease, border-color .2s ease;
    }
    .tool-link:hover { border-color: var(--accent); box-shadow: var(--button-glow); transform: translateY(-1px); }

    /* NEW: MasterTools grid cards */
    .grid { display:grid; grid-template-columns: repeat(auto-fill, minmax(240px, 1fr)); gap: .8rem; }
    .card { border:1px solid var(--border); background: var(--card-bg); border-radius: var(--radius); padding: .9rem; display:flex; flex-direction:column; gap:.7rem; }
    .card h3 { margin:0; font-size:1rem; color: var(--accent-2); }
    .card p { margin:0; color: var(--muted); font-size:.92rem; min-height: 2.2em; }
    .card .row { display:flex; gap:.5rem; }
    .icon-btn { background: transparent; border:1px solid var(--border); border-radius: 10px; padding:.45rem .6rem; color: var(--text); cursor: pointer; }
    .icon-btn:hover { border-color: var(--accent); box-shadow: var(--button-glow); }
    .favorite[aria-pressed="true"] { border-color: var(--accent); box-shadow: var(--button-glow); }

    .footer {
      margin-top: auto; text-align: center; font-size: .9rem; padding: 1rem; color: #b9dfe6;
    }

    #visitInfo { cursor: pointer; font-size: 1rem; }
    #countryStats { font-size:.95rem; color: var(--muted); }
  </style>
</head>
<body>
  <h1>üöÄ Productivity Boost Hub <span class="pill" id="buildTag" title="Build tag">v2025.08.30</span></h1>

  <div class="topbar">
    <!-- Tabs -->
    <div class="tabs" role="tablist" aria-label="Sections">
      <button class="tab" role="tab" data-target="reports" aria-controls="reports" aria-selected="true">üìä Share Reports</button>
      <button class="tab" role="tab" data-target="guide" aria-controls="guide" aria-selected="false">üß© Problem Solve Guide</button>
      <button class="tab" role="tab" data-target="scripts" aria-controls="scripts" aria-selected="false">üß† Tampermonkey Scripts</button>
      <button class="tab" role="tab" data-target="mastertools" aria-controls="mastertools" aria-selected="false">üß∞ MasterTools</button>
    </div>

    <!-- Controls -->
    <div class="controls">
      <button class="btn" id="emojiToggle" type="button" aria-pressed="true">üòé Emojis: ON</button>
      <button class="btn secondary" id="expandAll" type="button" data-mode="expand">Expand all</button>
      <button class="btn" id="refreshBtn" type="button" title="Reload current section">‚Üª Refresh</button>
      <div id="visitInfo" class="pill" onclick="toggleCountryStats()" title="Click to toggle details">üëÅÔ∏è Total Visits: Loading...</div>
      <div id="countryStats"></div>
    </div>
  </div>

  <!-- REPORTS -->
  <section id="reports" class="section active" role="tabpanel" aria-labelledby="tab-reports">
    <input type="text" id="reportSearch" class="search" placeholder="üîç Search reports..." aria-label="Search reports">
    <div id="reportContainer" style="margin-top:.8rem"></div>
    <div id="error" class="error-msg"></div>
  </section>

  <!-- GUIDE -->
  <section id="guide" class="section" role="tabpanel" aria-labelledby="tab-guide">
    <input type="text" id="guideSearch" class="search" placeholder="üîç Search guide..." aria-label="Search guide">
    <div id="guideContainer" style="margin-top:.8rem"></div>
  </section>

  <!-- SCRIPTS -->
  <section id="scripts" class="section" role="tabpanel" aria-labelledby="tab-scripts">
    <input type="text" id="scriptSearch" class="search" placeholder="üîç Search scripts..." aria-label="Search scripts">
    <div class="category" id="submitCategory">
      <div class="category-header" data-accordion>
        <span>üìù Submit your script</span>
        <span aria-hidden>‚ñæ</span>
      </div>
      <div class="category-content">
        <div class="card">
          <p>Want to share your script? Fill the form and it will appear here after review.</p>
          <div class="row">
            <a class="tool-link" href="https://docs.google.com/forms/d/e/1FAIpQLSdVhvhkmE28nIxDH2DAo4FR7W14zqUxp2KlGHvib6baAMplEQ/viewform" target="_blank" rel="noopener">Open Google Form</a>
            <a class="tool-link" href="https://drive.google.com/drive/folders/1Ob9wywyzwtR3ecBAZrYqJxdqDBwbaH0I" target="_blank" rel="noopener">Shared Drive Folder</a>
          </div>
        </div>
      </div>
    </div>
    <div id="scriptContainer"></div>
  </section>

  <!-- M A S T E R T O O L S -->
  <section id="mastertools" class="section" role="tabpanel" aria-labelledby="tab-mastertools">
    <input type="text" id="masterSearch" class="search" placeholder="üîç Search MasterTools..." aria-label="Search master tools">
    <div class="grid" id="masterGrid" style="margin-top:.8rem"></div>
    <ul class="tool-list" id="masterLegacy" hidden>
      <li>
        <a class="tool-link" href="trailer-plan.html" target="_blank" rel="noopener">üöõ Trailer Plan Analyzer</a>
      </li>
    </ul>
  </section>

  <div class="footer">Created by qjuflore | Juan Flores</div>

  <!-- Optional external file: kept for backwards-compat. If present, its functions will be used. -->
  <script src="script.js" defer></script>

  <script>
  (function() {
    const $ = (sel, root=document) => root.querySelector(sel);
    const $$ = (sel, root=document) => Array.from(root.querySelectorAll(sel));

    // ---------- Persisted UI state ----------
    const LS = {
      tab: 'pb.activeTab',
      emoji: 'pb.emojis',
      favs: 'pb.master.favorites',
      expand: 'pb.expandAll',
    };

    const state = {
      get activeTab() { return localStorage.getItem(LS.tab) || 'reports'; },
      set activeTab(v) { localStorage.setItem(LS.tab, v); },
      get emojis() { return localStorage.getItem(LS.emoji) !== 'off'; },
      set emojis(flag) { localStorage.setItem(LS.emoji, flag ? 'on' : 'off'); },
      get favorites() { try { return JSON.parse(localStorage.getItem(LS.favs) || '[]'); } catch { return []; } },
      set favorites(list) { localStorage.setItem(LS.favs, JSON.stringify(list)); },
      get expandAll() { return localStorage.getItem(LS.expand) === 'on'; },
      set expandAll(flag) { localStorage.setItem(LS.expand, flag ? 'on' : 'off'); },
    };

    // ---------- Tabs (fixes MasterTools selection, URL hash / ?tab support) ----------
    function setActiveTab(id) {
      // switch sections
      $$('.section').forEach(sec => sec.classList.toggle('active', sec.id === id));
      // switch tabs
      $$('.tab').forEach(tab => {
        const selected = tab.dataset.target === id;
        tab.classList.toggle('active', selected);
        tab.setAttribute('aria-selected', selected ? 'true' : 'false');
      });
      // persist & url
      state.activeTab = id;
      const url = new URL(location.href);
      url.searchParams.set('tab', id);
      url.hash = `#${id}`;
      history.replaceState(null, '', url);
      updateExpandAllButton();
    }

    function initTabs() {
      $$('.tab').forEach(tab => tab.addEventListener('click', () => setActiveTab(tab.dataset.target)));
      // hash / query support
      const url = new URL(location.href);
      const fromQuery = url.searchParams.get('tab');
      const fromHash = location.hash?.replace('#','');
      const initial = fromQuery || fromHash || state.activeTab || 'reports';
      setActiveTab(initial);
    }

    // expose for external calls
    window.showSection = setActiveTab;

    // ---------- Controls ----------
    const emojiBtn = $('#emojiToggle');
    function syncEmojiToggle() {
      const on = state.emojis;
      emojiBtn.setAttribute('aria-pressed', on ? 'true' : 'false');
      emojiBtn.textContent = on ? 'üòé Emojis: ON' : 'üôÇ Emojis: OFF';
      document.documentElement.classList.toggle('emoji-off', !on);
    }
    emojiBtn.addEventListener('click', () => { state.emojis = !state.emojis; syncEmojiToggle(); });

    $('#refreshBtn').addEventListener('click', () => {
      // call section-specific refreshers if available; fallback to location reload
      const id = state.activeTab;
      const map = { reports: 'loadReports', guide: 'loadGuide', scripts: 'loadScripts', mastertools: 'renderMasterTools' };
      const fn = window[map[id]];
      if (typeof fn === 'function') fn(); else location.reload();
    });

    // ---------- Accordion behavior ----------
    function toggleAccordion(catEl, explicit) {
      if (!catEl) return;
      const open = explicit ?? !catEl.classList.contains('open');
      catEl.classList.toggle('open', open);
    }
    document.addEventListener('click', (e) => {
      const header = e.target.closest('[data-accordion]');
      if (header) toggleAccordion(header.closest('.category'));
    });

    // Expand/Collapse All (per current section)
    const expandBtn = $('#expandAll');
    function updateExpandAllButton() {
      const wantOpen = state.expandAll;
      expandBtn.dataset.mode = wantOpen ? 'collapse' : 'expand';
      expandBtn.textContent = wantOpen ? 'Collapse all' : 'Expand all';
    }
    expandBtn.addEventListener('click', () => {
      state.expandAll = !state.expandAll;
      updateExpandAllButton();
      const sec = $('#'+state.activeTab);
      $$('.category', sec).forEach(c => c.classList.toggle('open', state.expandAll));
    });

    // ---------- Dummy visits (placeholder) ----------
    window.toggleCountryStats = function() {
      const stats = $('#countryStats');
      if (stats.textContent) { stats.textContent = ''; return; }
      stats.textContent = 'üá∫üá∏ US 87% ¬∑ üá≤üáΩ MX 7% ¬∑ üåé Others 6% (demo)';
    }
    $('#visitInfo').textContent = 'üëÅÔ∏è Total Visits: 12,480 (demo)';

    // ---------- Search helpers (simple contains filter) ----------
    function attachSearch(input, container) {
      if (!input || !container) return;
      input.addEventListener('input', () => {
        const q = input.value.trim().toLowerCase();
        const items = container.children;
        for (const el of items) {
          const text = el.textContent.toLowerCase();
          el.style.display = q ? (text.includes(q) ? '' : 'none') : '';
        }
      });
    }

    // ---------- MasterTools (cards + favorites + search) ----------
    const MASTER_DATA = [
      {
        id: 'trailer-plan',
        icon: 'üöõ',
        name: 'Trailer Plan Analyzer',
        href: 'trailer-plan.html',
        desc: 'Plan injection, density & severity attributes for trailers.'
      },
      // Add more tools here ‚Üì
      // { id: 'aft-smart-analyzer', icon: 'üß†', name: 'AFT Smart Analyzer', href: 'aft-smart.html', desc: 'Search all tabs, export CSV, modern UI.' },
    ];

    function isFav(id) { return state.favorites.includes(id); }

    function toggleFav(id, btn) {
      const favs = new Set(state.favorites);
      if (favs.has(id)) favs.delete(id); else favs.add(id);
      state.favorites = Array.from(favs);
      if (btn) btn.setAttribute('aria-pressed', isFav(id) ? 'true' : 'false');
      renderMasterTools(); // keep list ordered with favorites first
    }

    function toolCard(t) {
      const card = document.createElement('div');
      card.className = 'card';
      card.dataset.id = t.id;
      card.innerHTML = `
        <h3>${t.icon} ${t.name}</h3>
        <p>${t.desc || ''}</p>
        <div class="row">
          <a class="tool-link" href="${t.href}" target="_blank" rel="noopener">Open</a>
          <button class="icon-btn favorite" aria-pressed="${isFav(t.id)}" title="Favorite">‚òÖ</button>
          <button class="icon-btn" title="Copy link">‚ßâ</button>
        </div>
      `;
      const [openLink, favBtn, copyBtn] = card.querySelectorAll('.row > *');
      favBtn.addEventListener('click', () => toggleFav(t.id, favBtn));
      copyBtn.addEventListener('click', async () => {
        try { await navigator.clipboard.writeText(new URL(t.href, location.href).href); copyBtn.textContent = '‚úî'; setTimeout(()=>copyBtn.textContent='‚ßâ', 900); } catch {}
      });
      return card;
    }

    window.renderMasterTools = function renderMasterTools() {
      const wrap = $('#masterGrid');
      if (!wrap) return;
      wrap.innerHTML = '';
      const data = [...MASTER_DATA];
      // favorites first
      data.sort((a,b) => (isFav(b.id) - isFav(a.id)) || a.name.localeCompare(b.name));
      data.forEach(t => wrap.appendChild(toolCard(t)));
    }

    // search for mastertools
    const masterSearch = $('#masterSearch');
    if (masterSearch) masterSearch.addEventListener('input', () => {
      const q = masterSearch.value.trim().toLowerCase();
      $$('#masterGrid .card').forEach(card => {
        const txt = card.textContent.toLowerCase();
        card.style.display = q ? (txt.includes(q) ? '' : 'none') : '';
      });
    });

    // ---------- Stubs for external loaders so Refresh works ----------
    window.loadReports = window.loadReports || function(){};
    window.loadGuide   = window.loadGuide   || function(){};
    window.loadScripts = window.loadScripts || function(){};

    // ---------- Init ----------
    initTabs();
    syncEmojiToggle();
    renderMasterTools();
    attachSearch($('#reportSearch'), $('#reportContainer'));
    attachSearch($('#guideSearch'), $('#guideContainer'));
    attachSearch($('#scriptSearch'), $('#scriptContainer'));
    updateExpandAllButton();

    // Keyboard nav: Ctrl+ArrowLeft/Right to switch tabs
    document.addEventListener('keydown', (e) => {
      if (!e.ctrlKey) return;
      if (e.key === 'ArrowRight' || e.key === 'ArrowLeft') {
        const tabs = $$('.tab');
        const idx = tabs.findIndex(t => t.dataset.target === state.activeTab);
        if (idx < 0) return;
        const next = e.key === 'ArrowRight' ? (idx + 1) % tabs.length : (idx - 1 + tabs.length) % tabs.length;
        setActiveTab(tabs[next].dataset.target);
      }
    });

    // Accessibility: focus active tab on hash change
    window.addEventListener('hashchange', () => {
      const id = location.hash.replace('#','');
      if (id) setActiveTab(id);
    });
  })();
  </script>
</body>
</html>
